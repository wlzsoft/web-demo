<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.dao.ReviewDao">
	
	  <insert id="savaUserExcerciseDetail" parameterType="com.demo.entity.UserExerciseDetailEntity">
	  	 INSERT INTO userExerciseDetail(
				userId,
				cardId,
				pointId,
				exerciseDate,
				startExerciseTime,
				endExerciseTime,
				exerciseUpshot
		)VALUES(
				#{userId},
				#{cardId},
				#{pointId},
				#{exerciseDate},
				#{startExerciseTime},
				#{endExerciseTime},
				#{exerciseUpshot}
		)
	  
	  </insert>
	  
	  <update id="updateLorePointExerciseDetail" parameterType="com.demo.entity.LorePointExerciseDetailEntity">
	  		 UPDATE pointExerciseDetail set
			   nextExerciseTime=#{nextExerciseTime},
			   exerciseCycle=#{exerciseCycle},
			   conCorrectNumber=#{conCorrectNumber},
			   conErrorNumber=#{conErrorNumber},
			   lastExerciseDate=#{lastExerciseDate},
			   exerciseNumber=#{exerciseNumber},
			   correctNumber=#{correctNumber},
			   errorNumber=#{errorNumber}
		     where id=#{id}
	  </update>
	  
	  <select id="bookList" parameterType="java.lang.Integer" resultType="com.demo.dto.BookDto">
		  	SELECT 
		  	  t.id,
		  	  t.bookName,
		  	  t.sharedType,
		  	  t.createId
		  	 FROM book  t 
		  	 WHERE t.createId=#{userId}
		  	   ORDER BY t.id ASC
	  </select>
	  
	  <select id="reviewPoint" parameterType="java.lang.Integer" resultType="com.demo.dto.PonitDto">
	  
		  	SELECT t.id ,
		  		t.pointName,
		  		t.chapterId,
		  		t.number
		  	FROM
			  point t ,
			  pointExerciseDetail a ,
			  chapter b
			WHERE b.bookId=#{bookId}
			  AND t.chapterId=b.id
			  AND t.id = a.pointId 
			  AND a.userId=#{userId}
			  AND a.nextExerciseTime is not NULL
			  AND a.nextExerciseTime <![CDATA[ <= ]]> NOW()
			ORDER BY  a.nextExerciseTime asc 
	  </select>
	  
	  <select id="reviewPointNull" parameterType="java.lang.Integer" resultType="com.demo.dto.PonitDto">
		  	SELECT t.id ,
		  		t.pointName,
		  		t.chapterId,
		  		t.number
		  	FROM
			  point t ,
			  pointExerciseDetail a ,
			  chapter b
			WHERE b.bookId=#{bookId}
			  AND t.chapterId=b.id
			  AND t.id = a.pointId 
			  AND a.userId=#{userId}
			  AND a.nextExerciseTime is NULL
			ORDER BY  t.id asc 
	  </select>
     
</mapper>