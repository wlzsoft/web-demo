<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.dao.ReviewDao">
	
	  <insert id="savaUserExcerciseDetail" parameterType="com.demo.entity.UserExerciseDetailEntity">
	  	 INSERT INTO userExerciseDetail(
				userId,
				cardId,
				pointId,
				exerciseDate,
				startExerciseTime,
				endExerciseTime,
				exerciseUpshot
		)VALUES(
				#{userId},
				#{cardId},
				#{pointId},
				#{exerciseDate},
				#{startExerciseTime},
				#{endExerciseTime},
				#{exerciseUpshot}
		)
	  
	  </insert>
	  
	  <update id="updateLorePointExerciseDetail" parameterType="com.demo.entity.LorePointExerciseDetailEntity">
	  		 UPDATE pointExerciseDetail set
			   nextExerciseTime=#{nextExerciseTime},
			   exerciseCycle=#{exerciseCycle},
			   conCorrectNumber=#{conCorrectNumber},
			   conErrorNumber=#{conErrorNumber},
			   lastExerciseDate=#{lastExerciseDate},
			   exerciseNumber=#{exerciseNumber},
			   correctNumber=#{correctNumber},
			   errorNumber=#{errorNumber}
		     where id=#{id}
	  </update>
	  
	  <select id="bookList" parameterType="java.lang.Integer" resultType="com.demo.dto.BookDto">
		  	SELECT 
		  	  t.id,
		  	  t.bookName,
		  	  t.sharedType,
		  	  t.createId
		  	 FROM book  t 
		  	 WHERE t.createId=#{userId}
		  	   ORDER BY t.id ASC
	  </select>
	  
	  <select id="reviewPoint" parameterType="java.lang.Integer" resultType="com.demo.dto.PonitDto">
	  
		  	SELECT t.id ,
		  		t.pointName,
		  		t.chapterId,
		  		t.number,
		  		t.bookId
		  	FROM
			  point t ,
			  pointExerciseDetail a ,
			  chapter b
			WHERE b.bookId=#{bookId}
			  AND t.chapterId=b.id
			  AND t.id = a.pointId 
			  AND t.number>0
			  AND a.userId=#{userId}
			  AND a.nextExerciseTime is not NULL
			  AND a.nextExerciseTime <![CDATA[ <= ]]> NOW()
			ORDER BY  a.nextExerciseTime asc 
	  </select>
	  
	  <select id="reviewPointNull" parameterType="java.lang.Integer" resultType="com.demo.dto.PonitDto">
		  	SELECT t.id ,
		  		t.pointName,
		  		t.chapterId,
		  		t.number,
		  		t.bookId
		  	FROM
			  point t ,
			  pointExerciseDetail a ,
			  chapter b
			WHERE b.bookId=#{bookId}
			  AND t.chapterId=b.id
			  AND t.id = a.pointId 
			  AND t.number>0
			  AND a.userId=#{userId}
			  AND a.nextExerciseTime is NULL
			ORDER BY  t.id asc 
	  </select>
	  
	  <select id="roundCard" parameterType="java.lang.Integer" resultType="com.demo.dto.CardDto">
          select t.id,t.pointId ,b.pointName ,t.questionType,
                t.difficultyLevel,t.titleText,t.questionText,t.questionImages,t.answers
          from card t ,point b  
          where  t.pointId=b.id and t.pointId=#{pointId} AND b.number>0
       </select> 
       
       <select id="roundPoint" parameterType="java.lang.Integer" resultType="com.demo.dto.PonitDto">
	     SELECT t.id,t.pointName,t.number,t.chapterId ,t.bookId
	         FROM point t ,pointExerciseDetail a
	          WHERE t.id=a.pointId 
	          AND t.number>0
	          AND a.userId=#{userId}
	   </select>
	  
</mapper>